function init(){var e=5,t=15,n=200,s=document.querySelector(".table"),l=document.querySelectorAll(".row"),a=document.querySelectorAll(".cell"),o="cell--active",r=document.querySelector(".btn-start"),c=document.querySelector(".start-overlay"),d=document.querySelector(".coins-box").children[0],u=document.createElement("img");u.classList.add("apple-img"),u.src="img/apple.svg",u.alt="apple";var i=document.createElement("p");i.classList.add("message");var m=[],w=L,g=0;function h(e,t){this.row=e,this.cell=t}function p(){return m[m.length-1].row}function y(){return m[m.length-1].cell}function v(){s.rows[p()].cells[y()].classList.add(o),s.rows[p()].cells[y()].dataset.snake="s"}function f(){s.rows[m[0].row].cells[m[0].cell].classList.remove(o),s.rows[m[0].row].cells[m[0].cell].removeAttribute("data-snake"),m.shift()}function k(){var e=Math.floor(Math.random()*l.length),t=Math.floor(Math.random()*a.length/l.length);"s"===s.rows[e].cells[t].dataset.snake?k():(s.rows[e].cells[t].dataset.tag="a",s.rows[e].cells[t].appendChild(u),0===g?(i.innerHTML="Let's play?",s.rows[e].cells[t].appendChild(i)):1===g?(i.innerHTML="А есть меня-то зачем?",s.rows[e].cells[t].appendChild(i)):2===g&&(i.innerHTML="Фигня, а не игра...",s.rows[e].cells[t].appendChild(i)))}function q(){document.querySelector('[data-tag="a"]').removeAttribute("data-tag"),document.querySelector(".message")&&document.querySelector(".message").remove(),document.querySelector(".apple-img")&&document.querySelector(".apple-img").remove(),++g,d.innerHTML=g}function L(){"a"===s.rows[p()-1].cells[y()].dataset.tag&&p()-1>=0&&(m.push(new h(p()-1,y())),v(),q()),p()-1>=0&&(m.push(new h(p()-1,y())),v(),f())}function S(){"a"===s.rows[p()+1].cells[y()].dataset.tag&&p()+1<=l.length-1&&(m.push(new h(p()+1,y())),v(),q()),p()+1<=l.length-1&&(m.push(new h(p()+1,y())),v(),f())}function M(){"a"===s.rows[p()].cells[y()+1].dataset.tag&&y()+1<=a.length/l.length-1&&(m.push(new h(p(),y()+1)),v(),q()),y()+1<=a.length/l.length-1&&(m.push(new h(p(),y()+1)),v(),f())}function b(){"a"===s.rows[p()].cells[y()-1].dataset.tag&&y()-1>=0&&(m.push(new h(p(),y()-1)),v(),q()),y()-1>=0&&(m.push(new h(p(),y()-1)),v(),f())}function E(e){e.preventDefault();var t=e.keyCode;38!==t&&40!==t&&37!==t&&39!==t||(39===t&&w!==b?w=M:38===t&&w!==S?w=L:40===t&&w!==L?w=S:37===t&&w!==M&&(w=b),window.removeEventListener("keydown",E))}r.addEventListener("click",A);window.addEventListener("keydown",function(e){13===e.keyCode&&"none"!==c.style.display&&A()});function A(){c.style.display="none",function(){for(var n=0;n<e;n++)s.rows[l.length-1-n].cells[t-1].classList.add(o),s.rows[l.length-1-n].cells[t-1].dataset.snake="s",m.push(new h(l.length-1-n,t-1))}(),k(),setTimeout(function e(){var t,r;window.addEventListener("keydown",E),document.querySelector('[data-tag="a"]')||k(),0===p()&&w===L||p()===l.length-1&&w===S||0===y()&&w===b||y()===a.length/l.length-1&&w===M||0===p()&&w===S&&"s"===s.rows[p()+1].cells[y()].dataset.snake||p()===l.length-1&&w===L&&"s"===s.rows[p()-1].cells[y()].dataset.snake||0===y()&&w===M&&"s"===s.rows[p()].cells[y()+1].dataset.snake||y()===a.length/l.length-1&&w===b&&"s"===s.rows[p()].cells[y()-1].dataset.snake||p()-1>=0&&p()+1<=l.length-1&&y()-1>=0&&y()+1<=a.length/l.length-1&&("s"===s.rows[p()-1].cells[y()].dataset.snake&&w===L||"s"===s.rows[p()+1].cells[y()].dataset.snake&&w===S||"s"===s.rows[p()].cells[y()-1].dataset.snake&&w===b||"s"===s.rows[p()].cells[y()+1].dataset.snake&&w===M)?(t=document.querySelectorAll("."+o),r=document.querySelector('[data-tag="a"]'),t.forEach(function(e){e.classList.remove(o),e.removeAttribute("data-snake")}),r.removeAttribute("data-tag"),document.querySelector(".apple-img")&&document.querySelector(".apple-img").remove(),document.querySelector(".message")&&document.querySelector(".message").remove(),g=0,d.innerHTML=0,w=L,c.style.display="block",m=[],alert("game over")):(w(),setTimeout(e,n-2*g))},n)}}window.addEventListener("DOMContentLoaded",init);